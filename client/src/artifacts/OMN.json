{
  "contractName": "OMN",
  "abi": [
    {
      "name": "Valid",
      "inputs": [
        {
          "type": "address",
          "name": "eco",
          "indexed": true
        }
      ],
      "anonymous": false,
      "type": "event"
    },
    {
      "name": "Buy",
      "inputs": [
        {
          "type": "address",
          "name": "eco",
          "indexed": true
        }
      ],
      "anonymous": false,
      "type": "event"
    },
    {
      "name": "Write",
      "inputs": [
        {
          "type": "address",
          "name": "eco",
          "indexed": true
        }
      ],
      "anonymous": false,
      "type": "event"
    },
    {
      "name": "Exercise",
      "inputs": [
        {
          "type": "address",
          "name": "eco",
          "indexed": true
        }
      ],
      "anonymous": false,
      "type": "event"
    },
    {
      "name": "Mature",
      "inputs": [
        {
          "type": "address",
          "name": "eco",
          "indexed": true
        }
      ],
      "anonymous": false,
      "type": "event"
    },
    {
      "name": "Payment",
      "inputs": [
        {
          "type": "uint256",
          "name": "amount",
          "indexed": false,
          "unit": "wei"
        },
        {
          "type": "address",
          "name": "source",
          "indexed": true
        }
      ],
      "anonymous": false,
      "type": "event"
    },
    {
      "name": "Transfer",
      "inputs": [
        {
          "type": "address",
          "name": "_from",
          "indexed": true
        },
        {
          "type": "address",
          "name": "_to",
          "indexed": true
        },
        {
          "type": "uint256",
          "name": "_value",
          "indexed": false
        }
      ],
      "anonymous": false,
      "type": "event"
    },
    {
      "name": "Approval",
      "inputs": [
        {
          "type": "address",
          "name": "_owner",
          "indexed": true
        },
        {
          "type": "address",
          "name": "_spender",
          "indexed": true
        },
        {
          "type": "uint256",
          "name": "_value",
          "indexed": false
        }
      ],
      "anonymous": false,
      "type": "event"
    },
    {
      "name": "Error",
      "inputs": [
        {
          "type": "uint256",
          "name": "fund",
          "indexed": false
        },
        {
          "type": "uint256",
          "name": "margn",
          "indexed": false
        }
      ],
      "anonymous": false,
      "type": "event"
    },
    {
      "constant": false,
      "payable": true,
      "type": "fallback"
    },
    {
      "name": "setup",
      "outputs": [],
      "inputs": [
        {
          "type": "uint256",
          "name": "_strike"
        },
        {
          "type": "uint256",
          "name": "_underlying"
        },
        {
          "type": "uint256",
          "unit": "sec",
          "name": "_maturity"
        },
        {
          "type": "address",
          "name": "_slate_address"
        },
        {
          "type": "address",
          "name": "_stash_address"
        },
        {
          "type": "address",
          "name": "_wax_address"
        },
        {
          "type": "address",
          "name": "_dai_address"
        },
        {
          "type": "address",
          "name": "_oat_address"
        }
      ],
      "constant": false,
      "payable": false,
      "type": "function",
      "gas": 393853
    },
    {
      "name": "isMature",
      "outputs": [
        {
          "type": "bool",
          "name": "out"
        }
      ],
      "inputs": [],
      "constant": true,
      "payable": false,
      "type": "function",
      "gas": 2305
    },
    {
      "name": "purchase",
      "outputs": [
        {
          "type": "bool",
          "name": "out"
        }
      ],
      "inputs": [
        {
          "type": "uint256",
          "name": "prm"
        }
      ],
      "constant": false,
      "payable": true,
      "type": "function",
      "gas": 38863
    },
    {
      "name": "write",
      "outputs": [
        {
          "type": "bool",
          "name": "out"
        }
      ],
      "inputs": [
        {
          "type": "uint256",
          "name": "prm"
        },
        {
          "type": "uint256",
          "name": "_margin"
        }
      ],
      "constant": false,
      "payable": true,
      "type": "function",
      "gas": 6489
    },
    {
      "name": "validate",
      "outputs": [
        {
          "type": "bool",
          "name": "out"
        }
      ],
      "inputs": [],
      "constant": false,
      "payable": false,
      "type": "function",
      "gas": 50212
    },
    {
      "name": "exercise",
      "outputs": [
        {
          "type": "bool",
          "name": "out"
        }
      ],
      "inputs": [],
      "constant": false,
      "payable": true,
      "type": "function",
      "gas": 102459
    },
    {
      "name": "factory",
      "outputs": [
        {
          "type": "address",
          "unit": "Factory",
          "name": "out"
        }
      ],
      "inputs": [],
      "constant": true,
      "payable": false,
      "type": "function",
      "gas": 731
    },
    {
      "name": "slate",
      "outputs": [
        {
          "type": "address",
          "unit": "Slate",
          "name": "out"
        }
      ],
      "inputs": [],
      "constant": true,
      "payable": false,
      "type": "function",
      "gas": 761
    },
    {
      "name": "stash",
      "outputs": [
        {
          "type": "address",
          "unit": "Stash",
          "name": "out"
        }
      ],
      "inputs": [],
      "constant": true,
      "payable": false,
      "type": "function",
      "gas": 791
    },
    {
      "name": "wax",
      "outputs": [
        {
          "type": "address",
          "unit": "Wax",
          "name": "out"
        }
      ],
      "inputs": [],
      "constant": true,
      "payable": false,
      "type": "function",
      "gas": 821
    },
    {
      "name": "dai",
      "outputs": [
        {
          "type": "address",
          "unit": "Dai",
          "name": "out"
        }
      ],
      "inputs": [],
      "constant": true,
      "payable": false,
      "type": "function",
      "gas": 851
    },
    {
      "name": "oat",
      "outputs": [
        {
          "type": "address",
          "unit": "Oat",
          "name": "out"
        }
      ],
      "inputs": [],
      "constant": true,
      "payable": false,
      "type": "function",
      "gas": 881
    },
    {
      "name": "strike",
      "outputs": [
        {
          "type": "uint256",
          "name": "out"
        }
      ],
      "inputs": [],
      "constant": true,
      "payable": false,
      "type": "function",
      "gas": 911
    },
    {
      "name": "underlying",
      "outputs": [
        {
          "type": "uint256",
          "name": "out"
        }
      ],
      "inputs": [],
      "constant": true,
      "payable": false,
      "type": "function",
      "gas": 941
    },
    {
      "name": "maturity",
      "outputs": [
        {
          "type": "uint256",
          "unit": "sec",
          "name": "out"
        }
      ],
      "inputs": [],
      "constant": true,
      "payable": false,
      "type": "function",
      "gas": 971
    },
    {
      "name": "active",
      "outputs": [
        {
          "type": "bool",
          "name": "out"
        }
      ],
      "inputs": [],
      "constant": true,
      "payable": false,
      "type": "function",
      "gas": 1001
    },
    {
      "name": "completed",
      "outputs": [
        {
          "type": "bool",
          "name": "out"
        }
      ],
      "inputs": [],
      "constant": true,
      "payable": false,
      "type": "function",
      "gas": 1031
    },
    {
      "name": "expiration",
      "outputs": [
        {
          "type": "uint256",
          "unit": "sec",
          "name": "out"
        }
      ],
      "inputs": [],
      "constant": true,
      "payable": false,
      "type": "function",
      "gas": 1061
    }
  ],
  "bytecode": "0x610af656600436101561000d57610ac4565b600035601c52740100000000000000000000000000000000000000006020526f7fffffffffffffffffffffffffffffff6040527fffffffffffffffffffffffffffffffff8000000000000000000000000000000060605274012a05f1fffffffffffffffffffffffffdabf41c006080527ffffffffffffffffffffffffed5fa0e000000000000000000000000000000000060a05263f83a898860005114156101e95734156100ba57600080fd5b60643560205181106100cb57600080fd5b5060843560205181106100dd57600080fd5b5060a43560205181106100ef57600080fd5b5060c435602051811061010157600080fd5b5060e435602051811061011357600080fd5b5060003314156006541560005415161661012c57600080fd5b336000556004356007556024356008556044356009556000600a556000600b5560643560015560843560025560a43560035560c43560045560e435600555426201518081818301101561017e57600080fd5b80820190509050600c556004543b61019557600080fd5b60045430186101a357600080fd5b60206101e0604463095ea7b361014052600254610160526d314dc6448d9338c15b0a000000006101805261015c60006004545af16101e057600080fd5b6000506101e050005b63ae4e7fdf600051141561025757341561020257600080fd5b6003543b61020f57600080fd5b600354301861021d57600080fd5b60206101c060246307757be1610140526009546101605261015c6003545afa61024557600080fd5b6000506101c05160005260206000f350005b63efef39a16000511415610300576000600060006000346001546000f161027d57600080fd5b307f5c6c890314aa0d49059c35b35ff86ffb43efe8f543dc3691558f39dfa4a8201160006000a26001543b6102b157600080fd5b60015430186102bf57600080fd5b60206101e06044638de932226101405230610160526004356101805261015c60006001545af16102ee57600080fd5b6000506101e05160005260206000f350005b639c0e3f7a60005114156103f0576004543b61031b57600080fd5b600454301861032957600080fd5b602061020060646323b872dd610140523361016052600254610180526024356101a05261015c60006004545af161035f57600080fd5b60005061020050307f3d9850d7c40f30357297906847346c1d76b7ab7b248eb505c9b940534a680e5760006000a26001543b61039a57600080fd5b60015430186103a857600080fd5b60206102e0606463d52c26c8610220523061024052600435610260526024356102805261023c60006001545af16103de57600080fd5b6000506102e05160005260206000f350005b636901f66860005114156106ea57341561040957600080fd5b6308c379a0610140526020610160526012610180527f53686f756c6420626520696e61637469766500000000000000000000000000006101a05261018050600a541561045657608461015cfd5b6308c379a06101e0526020610200526015610220527f53686f756c646e7420626520636f6d706c6574656400000000000000000000006102405261022050600b54156104a35760846101fcfd5b60006002543b6104b257600080fd5b60025430186104c057600080fd5b60206103a060246323024408610320526001543b6104dd57600080fd5b60015430186104eb57600080fd5b6020610300602463533286ec61028052306102a05261029c6001545afa61051157600080fd5b600050610300516103405261033c6002545afa61052d57600080fd5b6000506103a0511161053e57600080fd5b60006001543b61054d57600080fd5b600154301861055b57600080fd5b60206104e0602463a61e6bf1610460526001543b61057857600080fd5b600154301861058657600080fd5b6020610440602463667022fd6103c052306103e0526103dc6001545afa6105ac57600080fd5b600050610440516104805261047c6001545afa6105c857600080fd5b6000506104e051116105d957600080fd5b6001543b6105e657600080fd5b60015430186105f457600080fd5b60206106c06024632e1a7d4d610640526001543b61061157600080fd5b600154301861061f57600080fd5b6020610620602463a61e6bf16105a0526001543b61063c57600080fd5b600154301861064a57600080fd5b6020610580602463667022fd61050052306105205261051c6001545afa61067057600080fd5b600050610580516105c0526105bc6001545afa61068c57600080fd5b600050610620516106605261065c60006001545af16106aa57600080fd5b6000506106c0506001600a55307fb16bddadd75f5e575957a0d58a6ecc1caaad819513f887396c0fbdb544aba40860006000a2600160005260206000f350005b63d32cb0fe60005114156108ef57600a5461070457600080fd5b6001543b61071157600080fd5b600154301861071f57600080fd5b60206101c0602463667022fd61014052306101605261015c6001545afa61074557600080fd5b6000506101c051331461075757600080fd5b6000600060006000346001546000f161076f57600080fd5b6001543b61077c57600080fd5b600154301861078a57600080fd5b60206102606024632e1a7d4d6101e05260075460085480820282158284830414176107b457600080fd5b80905090509050610200526101fc60006001545af16107d257600080fd5b600050610260506002543b6107e657600080fd5b60025430186107f457600080fd5b60206104406024632e1a7d4d6103c0526002543b61081157600080fd5b600254301861081f57600080fd5b60206103a060246323024408610320526001543b61083c57600080fd5b600154301861084a57600080fd5b6020610300602463533286ec61028052306102a05261029c6001545afa61087057600080fd5b600050610300516103405261033c6002545afa61088c57600080fd5b6000506103a0516103e0526103dc60006002545af16108aa57600080fd5b600050610440506000600a556001600b55307ffbda77129cf75888cf6abaff7c88653061908824c579c49cfb9224fce0918dbc60006000a2600160005260206000f350005b63c45a0155600051141561091657341561090857600080fd5b60005460005260206000f350005b636fe2a8a9600051141561093d57341561092f57600080fd5b60015460005260206000f350005b63d8da8131600051141561096457341561095657600080fd5b60025460005260206000f350005b639c550e81600051141561098b57341561097d57600080fd5b60035460005260206000f350005b63f4b9fa7560005114156109b25734156109a457600080fd5b60045460005260206000f350005b6353959ad060005114156109d95734156109cb57600080fd5b60055460005260206000f350005b63ad8f50086000511415610a005734156109f257600080fd5b60075460005260206000f350005b636f307dc36000511415610a27573415610a1957600080fd5b60085460005260206000f350005b63204f83f96000511415610a4e573415610a4057600080fd5b60095460005260206000f350005b6302fb0c5e6000511415610a75573415610a6757600080fd5b600a5460005260206000f350005b639d9a7fe96000511415610a9c573415610a8e57600080fd5b600b5460005260206000f350005b634665096d6000511415610ac3573415610ab557600080fd5b600c5460005260206000f350005b5b3461014052337ff817bef87c74de34ab725f43b121c1dff5324aa363f7b9ac176b9aee5115230e6020610140a25b610004610af603610004600039610004610af6036000f3",
  "deployedBytecode": "0x600436101561000d57610ac4565b600035601c52740100000000000000000000000000000000000000006020526f7fffffffffffffffffffffffffffffff6040527fffffffffffffffffffffffffffffffff8000000000000000000000000000000060605274012a05f1fffffffffffffffffffffffffdabf41c006080527ffffffffffffffffffffffffed5fa0e000000000000000000000000000000000060a05263f83a898860005114156101e95734156100ba57600080fd5b60643560205181106100cb57600080fd5b5060843560205181106100dd57600080fd5b5060a43560205181106100ef57600080fd5b5060c435602051811061010157600080fd5b5060e435602051811061011357600080fd5b5060003314156006541560005415161661012c57600080fd5b336000556004356007556024356008556044356009556000600a556000600b5560643560015560843560025560a43560035560c43560045560e435600555426201518081818301101561017e57600080fd5b80820190509050600c556004543b61019557600080fd5b60045430186101a357600080fd5b60206101e0604463095ea7b361014052600254610160526d314dc6448d9338c15b0a000000006101805261015c60006004545af16101e057600080fd5b6000506101e050005b63ae4e7fdf600051141561025757341561020257600080fd5b6003543b61020f57600080fd5b600354301861021d57600080fd5b60206101c060246307757be1610140526009546101605261015c6003545afa61024557600080fd5b6000506101c05160005260206000f350005b63efef39a16000511415610300576000600060006000346001546000f161027d57600080fd5b307f5c6c890314aa0d49059c35b35ff86ffb43efe8f543dc3691558f39dfa4a8201160006000a26001543b6102b157600080fd5b60015430186102bf57600080fd5b60206101e06044638de932226101405230610160526004356101805261015c60006001545af16102ee57600080fd5b6000506101e05160005260206000f350005b639c0e3f7a60005114156103f0576004543b61031b57600080fd5b600454301861032957600080fd5b602061020060646323b872dd610140523361016052600254610180526024356101a05261015c60006004545af161035f57600080fd5b60005061020050307f3d9850d7c40f30357297906847346c1d76b7ab7b248eb505c9b940534a680e5760006000a26001543b61039a57600080fd5b60015430186103a857600080fd5b60206102e0606463d52c26c8610220523061024052600435610260526024356102805261023c60006001545af16103de57600080fd5b6000506102e05160005260206000f350005b636901f66860005114156106ea57341561040957600080fd5b6308c379a0610140526020610160526012610180527f53686f756c6420626520696e61637469766500000000000000000000000000006101a05261018050600a541561045657608461015cfd5b6308c379a06101e0526020610200526015610220527f53686f756c646e7420626520636f6d706c6574656400000000000000000000006102405261022050600b54156104a35760846101fcfd5b60006002543b6104b257600080fd5b60025430186104c057600080fd5b60206103a060246323024408610320526001543b6104dd57600080fd5b60015430186104eb57600080fd5b6020610300602463533286ec61028052306102a05261029c6001545afa61051157600080fd5b600050610300516103405261033c6002545afa61052d57600080fd5b6000506103a0511161053e57600080fd5b60006001543b61054d57600080fd5b600154301861055b57600080fd5b60206104e0602463a61e6bf1610460526001543b61057857600080fd5b600154301861058657600080fd5b6020610440602463667022fd6103c052306103e0526103dc6001545afa6105ac57600080fd5b600050610440516104805261047c6001545afa6105c857600080fd5b6000506104e051116105d957600080fd5b6001543b6105e657600080fd5b60015430186105f457600080fd5b60206106c06024632e1a7d4d610640526001543b61061157600080fd5b600154301861061f57600080fd5b6020610620602463a61e6bf16105a0526001543b61063c57600080fd5b600154301861064a57600080fd5b6020610580602463667022fd61050052306105205261051c6001545afa61067057600080fd5b600050610580516105c0526105bc6001545afa61068c57600080fd5b600050610620516106605261065c60006001545af16106aa57600080fd5b6000506106c0506001600a55307fb16bddadd75f5e575957a0d58a6ecc1caaad819513f887396c0fbdb544aba40860006000a2600160005260206000f350005b63d32cb0fe60005114156108ef57600a5461070457600080fd5b6001543b61071157600080fd5b600154301861071f57600080fd5b60206101c0602463667022fd61014052306101605261015c6001545afa61074557600080fd5b6000506101c051331461075757600080fd5b6000600060006000346001546000f161076f57600080fd5b6001543b61077c57600080fd5b600154301861078a57600080fd5b60206102606024632e1a7d4d6101e05260075460085480820282158284830414176107b457600080fd5b80905090509050610200526101fc60006001545af16107d257600080fd5b600050610260506002543b6107e657600080fd5b60025430186107f457600080fd5b60206104406024632e1a7d4d6103c0526002543b61081157600080fd5b600254301861081f57600080fd5b60206103a060246323024408610320526001543b61083c57600080fd5b600154301861084a57600080fd5b6020610300602463533286ec61028052306102a05261029c6001545afa61087057600080fd5b600050610300516103405261033c6002545afa61088c57600080fd5b6000506103a0516103e0526103dc60006002545af16108aa57600080fd5b600050610440506000600a556001600b55307ffbda77129cf75888cf6abaff7c88653061908824c579c49cfb9224fce0918dbc60006000a2600160005260206000f350005b63c45a0155600051141561091657341561090857600080fd5b60005460005260206000f350005b636fe2a8a9600051141561093d57341561092f57600080fd5b60015460005260206000f350005b63d8da8131600051141561096457341561095657600080fd5b60025460005260206000f350005b639c550e81600051141561098b57341561097d57600080fd5b60035460005260206000f350005b63f4b9fa7560005114156109b25734156109a457600080fd5b60045460005260206000f350005b6353959ad060005114156109d95734156109cb57600080fd5b60055460005260206000f350005b63ad8f50086000511415610a005734156109f257600080fd5b60075460005260206000f350005b636f307dc36000511415610a27573415610a1957600080fd5b60085460005260206000f350005b63204f83f96000511415610a4e573415610a4057600080fd5b60095460005260206000f350005b6302fb0c5e6000511415610a75573415610a6757600080fd5b600a5460005260206000f350005b639d9a7fe96000511415610a9c573415610a8e57600080fd5b600b5460005260206000f350005b634665096d6000511415610ac3573415610ab557600080fd5b600c5460005260206000f350005b5b3461014052337ff817bef87c74de34ab725f43b121c1dff5324aa363f7b9ac176b9aee5115230e6020610140a2",
  "source": "# @title A Right to Call - Physically Settled ERC 20 Token\r\n# \r\n# @notice Implementation of a Tokenized American Call Option on the Ethereum Network\r\n# \r\n# @author Alexander Angel\r\n# \r\n# @dev Uses a factory to initialize and deploy option contracts\r\n#\r\n# @version 0.1.0b14\r\n\r\n\r\ncontract Factory():\r\n    def getEco(user_addr: address) -> address:constant\r\n    def getUser(eco: address) -> address:constant\r\n\r\ncontract Slate():\r\n    def bought(_option: address) -> address:constant\r\n    def wrote(_option: address) -> address:constant\r\n    def premium(_option: address) -> uint256:constant\r\n    def write(_option: address, prm: uint256, margin: uint256) -> bool:modifying\r\n    def purchase(_option: address, prm: uint256) -> bool:modifying\r\n    def withdraw(val: uint256) -> bool:modifying\r\n\r\ncontract Stash():\r\n    def fund(addr: address) -> uint256:constant\r\n    def deposit(_writer: address, margin: uint256) -> bool:modifying\r\n    def withdraw(val: uint256) -> bool:modifying\r\n    \r\ncontract Wax():\r\n    def timeToExpiry(time: timestamp) -> bool:constant\r\n    \r\ncontract Dai():\r\n    def totalSupply() -> uint256:constant\r\n    def balanceOf(_owner: address) -> uint256:constant\r\n    def allowance(_owner: address, _spender: address) -> uint256:constant\r\n    def transfer(_to: address, _value: uint256) -> bool:modifying\r\n    def transferFrom(_from: address, _to: address, _value: uint256) -> bool:modifying\r\n    def approve(_spender: address, _value: uint256) -> bool:modifying\r\n\r\ncontract Oat():\r\n    def totalSupply() -> uint256:constant\r\n    def balanceOf(_owner: address) -> uint256:constant\r\n    def allowance(_owner: address, _spender: address) -> uint256:constant\r\n    def transfer(_to: address, _value: uint256) -> bool:modifying\r\n    def transferFrom(_from: address, _to: address, _value: uint256) -> bool:modifying\r\n    def approve(_spender: address, _value: uint256) -> bool:modifying\r\n\r\n\r\nValid: event({eco: indexed(address)})\r\nBuy: event({eco: indexed(address)})\r\nWrite: event({eco: indexed(address)})\r\nExercise: event({eco: indexed(address)})\r\nMature: event({eco: indexed(address)})\r\nPayment: event({amount: wei_value, source: indexed(address)})\r\nTransfer: event({_from: indexed(address), _to: indexed(address), _value: uint256})\r\nApproval: event({_owner: indexed(address), _spender: indexed(address), _value: uint256})\r\n\r\n# Can delete\r\nError: event({fund: uint256, margn: uint256})\r\n\r\n\r\n# Interface Contracts\r\nfactory: public(Factory)\r\nslate: public(Slate)\r\nstash: public(Stash)\r\nwax: public(Wax)\r\ndai: public(Dai)\r\noat: public(Oat)\r\n\r\nuser: address\r\n\r\n# Contract parameters\r\nstrike: public(uint256)\r\nunderlying: public(uint256)\r\nmaturity: public(timestamp)\r\n\r\n# Exercise Conditions\r\nactive: public(bool)\r\ncompleted: public(bool)\r\nexpiration: public(timestamp)\r\n\r\n\r\n@public\r\n@payable\r\ndef __default__():\r\n    log.Payment(msg.value, msg.sender)\r\n\r\n@public\r\ndef setup(  _strike: uint256,\r\n            _underlying: uint256,\r\n            _maturity: timestamp,\r\n            _slate_address: address,\r\n            _stash_address: address,\r\n            _wax_address: address,\r\n            _dai_address: address,\r\n            _oat_address: address,\r\n            ):\r\n    \"\"\"\r\n    @notice Setup is called from the factory contract using an ECO contract template address\r\n    \"\"\"\r\n    assert(self.factory == ZERO_ADDRESS and self.user == ZERO_ADDRESS) and msg.sender != ZERO_ADDRESS\r\n    self.factory = Factory(msg.sender)\r\n    \r\n    self.strike = _strike\r\n    self.underlying = _underlying\r\n    self.maturity = _maturity\r\n\r\n    \r\n    \r\n\r\n    self.active = False\r\n    self.completed = False\r\n\r\n    # New\r\n    self.slate = Slate(_slate_address)\r\n    self.stash = Stash(_stash_address)\r\n    self.wax = Wax(_wax_address)\r\n    self.dai = Dai(_dai_address)\r\n    self.oat = Oat(_oat_address)\r\n    \r\n    self.expiration = block.timestamp + (60 * 60 * 24 * 1)\r\n    self.dai.approve(self.stash, 1000000000000000*10**18)\r\n\r\n\r\n# Need to fix, constant function? Or modifying function? How do I liquidate mature contracts?\r\n@public\r\n@constant\r\ndef isMature() -> bool:\r\n    \"\"\"\r\n    @notice ECOs have a time to expiration, this checks if it has expired\r\n    \"\"\"\r\n    return self.wax.timeToExpiry(self.maturity)\r\n\r\n@public\r\n@payable\r\ndef purchase(prm: uint256) -> bool:\r\n    \"\"\"\r\n    @notice Buyer purchases ECO for Premium:wei, Seller can claim Premium, Buyer is authorized\r\n    \"\"\"\r\n    send(self.slate, msg.value)\r\n    log.Buy(self)\r\n    return self.slate.purchase(self, prm)\r\n\r\n@public\r\n@payable\r\ndef write(prm: uint256, _margin: uint256) -> bool:\r\n    \"\"\"\r\n    @notice Seller writes ECO Contract, Deposits margin, Seller is authorized\r\n    \"\"\"\r\n    self.dai.transferFrom(msg.sender, self.stash, _margin)\r\n    log.Write(self)\r\n    return self.slate.write(self, prm, _margin)\r\n\r\n# Need to build DEX first\r\n# @public\r\n# @payable\r\n# def purchaseClose(prm: uint256) -> bool:\r\n#     \"\"\"\r\n#     @notice -   A writer can purchase their contract back to effectively close it - i.e. buy the obligation\r\n#     \"\"\"\r\n#     assert self.active\r\n#     assert msg.sender == self.slate.wrote(self)\r\n#     send(self.slate, msg.value) # Send the premium price to the Slate\r\n#     self.dai.transferFrom(  self.stash, # Transfer margin from Stash\r\n#                             msg.sender, # To Original writer\r\n#                             self.stash.fund(self.slate.wrote(self))) # Look up margin value, by looking up who wrote the option\r\n#     return self.slate.purchase(self, prm) # Update the slate to show a purchase order has been submitted\r\n#     \r\n# \r\n# @public\r\n# @payable\r\n# def sellClose() -> bool:\r\n#     \"\"\"\r\n#     @notice -   The Original purchaser may want to sell their option because the premium has appreciated.\r\n#     \"\"\"\r\n#     assert self.active\r\n#     assert msg.sender == self.slate.bought(self) # Asserts the sellClose order comes from someone who owns the option\r\n#     self.slate.write(   self, # Updates the slate with a new write\r\n#                         self.slate.premium(self.slate.bought(self)), # looks up premium, by looking up who purchased the option\r\n#                         self.stash.fund(self.slate.wrote(self))) # Looks up the margin, by looking up who wrote the option\r\n#     return self.slate.withdraw(self.slate.premium(self.slate.wrote(self))) # Purchase to Close offer withdraws the premium, by looking up who wrote the option\r\n\r\n\r\n@public\r\ndef validate() -> bool:\r\n    \"\"\"\r\n    @notice Checks if inactive, Checks Buyer & Seller's Authorization, Sends Premium to Seller, Activates Contract\r\n    \"\"\"\r\n    assert not self.active, 'Should be inactive'\r\n    assert not self.completed, 'Shouldnt be completed'\r\n    assert self.stash.fund(self.slate.wrote(self)) > 0 # Looks up margin\r\n    assert self.slate.premium(self.slate.bought(self)) > 0 # Looks up premium\r\n\r\n    # This tx looks confusing but it's not, it's just looking up what the premium is.\r\n    # Calling withdraw function of slate, which transfers an amt defined in parameter to the tx.origin of this tx\r\n    # The argument is looking up the premium value by looking up the buyer\r\n    # It's looking up the buyer by using this option's address, which is a map in slate.\r\n    self.slate.withdraw(self.slate.premium(self.slate.bought(self))) # Slate payment to writer equal to premium paid\r\n\r\n    self.active = True\r\n    log.Valid(self)\r\n    return True\r\n\r\n@public\r\n@payable\r\ndef exercise() -> bool:\r\n    \"\"\"\r\n    @notice If called from Buyer, Sends price * underlying Ether to Buyer, Sends strike * underlying to Seller, Completes\r\n    \"\"\"\r\n    assert self.active\r\n    assert msg.sender == self.slate.bought(self)\r\n\r\n    send(self.slate, msg.value) # Purchase of underlying asset * underlying amount @ strike price is sent to Slate\r\n    self.slate.withdraw(self.strike * self.underlying) # Writer receives payment from Slate\r\n    self.stash.withdraw(self.stash.fund(self.slate.wrote(self))) # Purchaser receives underlying asset * underlying amount\r\n\r\n    self.active = False\r\n    self.completed = True\r\n    log.Exercise(self)\r\n    return True\r\n",
  "sourcePath": "C:/Users/alexa/OneDrive/Documents/Master/Blockchain/Projects/Emerald_Project/contracts/OMN.vy",
  "compiler": {
    "name": "vyper",
    "version": "0.1.0b14+commit.49b201c"
  },
  "networks": {
    "5777": {
      "events": {
        "0xb16bddadd75f5e575957a0d58a6ecc1caaad819513f887396c0fbdb544aba408": {
          "name": "Valid",
          "inputs": [
            {
              "type": "address",
              "name": "eco",
              "indexed": true
            }
          ],
          "anonymous": false,
          "type": "event",
          "signature": "0xb16bddadd75f5e575957a0d58a6ecc1caaad819513f887396c0fbdb544aba408"
        },
        "0x5c6c890314aa0d49059c35b35ff86ffb43efe8f543dc3691558f39dfa4a82011": {
          "name": "Buy",
          "inputs": [
            {
              "type": "address",
              "name": "eco",
              "indexed": true
            }
          ],
          "anonymous": false,
          "type": "event",
          "signature": "0x5c6c890314aa0d49059c35b35ff86ffb43efe8f543dc3691558f39dfa4a82011"
        },
        "0x3d9850d7c40f30357297906847346c1d76b7ab7b248eb505c9b940534a680e57": {
          "name": "Write",
          "inputs": [
            {
              "type": "address",
              "name": "eco",
              "indexed": true
            }
          ],
          "anonymous": false,
          "type": "event",
          "signature": "0x3d9850d7c40f30357297906847346c1d76b7ab7b248eb505c9b940534a680e57"
        },
        "0xfbda77129cf75888cf6abaff7c88653061908824c579c49cfb9224fce0918dbc": {
          "name": "Exercise",
          "inputs": [
            {
              "type": "address",
              "name": "eco",
              "indexed": true
            }
          ],
          "anonymous": false,
          "type": "event",
          "signature": "0xfbda77129cf75888cf6abaff7c88653061908824c579c49cfb9224fce0918dbc"
        },
        "0x2eb828fdc16ef5c267a7b18c3f8edf180aaff1a8921c4fe994fef55ddc8abe60": {
          "name": "Mature",
          "inputs": [
            {
              "type": "address",
              "name": "eco",
              "indexed": true
            }
          ],
          "anonymous": false,
          "type": "event",
          "signature": "0x2eb828fdc16ef5c267a7b18c3f8edf180aaff1a8921c4fe994fef55ddc8abe60"
        },
        "0xf817bef87c74de34ab725f43b121c1dff5324aa363f7b9ac176b9aee5115230e": {
          "name": "Payment",
          "inputs": [
            {
              "type": "uint256",
              "name": "amount",
              "indexed": false,
              "unit": "wei"
            },
            {
              "type": "address",
              "name": "source",
              "indexed": true
            }
          ],
          "anonymous": false,
          "type": "event",
          "signature": "0xf817bef87c74de34ab725f43b121c1dff5324aa363f7b9ac176b9aee5115230e"
        },
        "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef": {
          "name": "Transfer",
          "inputs": [
            {
              "type": "address",
              "name": "_from",
              "indexed": true
            },
            {
              "type": "address",
              "name": "_to",
              "indexed": true
            },
            {
              "type": "uint256",
              "name": "_value",
              "indexed": false
            }
          ],
          "anonymous": false,
          "type": "event",
          "signature": "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"
        },
        "0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925": {
          "name": "Approval",
          "inputs": [
            {
              "type": "address",
              "name": "_owner",
              "indexed": true
            },
            {
              "type": "address",
              "name": "_spender",
              "indexed": true
            },
            {
              "type": "uint256",
              "name": "_value",
              "indexed": false
            }
          ],
          "anonymous": false,
          "type": "event",
          "signature": "0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925"
        },
        "0x38e3aaf1b2f2c930b2c3ad9e7ba74f151a8852833d7f1f4c6a12793fff19c927": {
          "name": "Error",
          "inputs": [
            {
              "type": "uint256",
              "name": "fund",
              "indexed": false
            },
            {
              "type": "uint256",
              "name": "margn",
              "indexed": false
            }
          ],
          "anonymous": false,
          "type": "event",
          "signature": "0x38e3aaf1b2f2c930b2c3ad9e7ba74f151a8852833d7f1f4c6a12793fff19c927"
        }
      },
      "links": {},
      "address": "0x5E4D41BD2D9d3f1F6f9EE17a17D635Df6CDB0ae2",
      "transactionHash": "0xecb35e81bb3292b671e4e2208799d2a8f146df75bb133569bb6395a4420574c2"
    }
  },
  "schemaVersion": "3.0.19",
  "updatedAt": "2019-11-15T22:40:28.930Z",
  "networkType": "ethereum"
}