{
  "contractName": "Genesis",
  "abi": [
    {
      "name": "Write",
      "inputs": [
        {
          "type": "address",
          "name": "_from",
          "indexed": true
        },
        {
          "type": "uint256",
          "name": "amount",
          "indexed": false
        },
        {
          "type": "uint256",
          "name": "key",
          "indexed": false
        }
      ],
      "anonymous": false,
      "type": "event"
    },
    {
      "name": "Exercise",
      "inputs": [
        {
          "type": "address",
          "name": "_from",
          "indexed": true
        },
        {
          "type": "uint256",
          "name": "amount",
          "indexed": false
        },
        {
          "type": "uint256",
          "name": "key",
          "indexed": false
        }
      ],
      "anonymous": false,
      "type": "event"
    },
    {
      "name": "Close",
      "inputs": [
        {
          "type": "address",
          "name": "_from",
          "indexed": true
        },
        {
          "type": "uint256",
          "name": "amount",
          "indexed": false
        },
        {
          "type": "uint256",
          "name": "key",
          "indexed": false
        }
      ],
      "anonymous": false,
      "type": "event"
    },
    {
      "name": "Mature",
      "inputs": [
        {
          "type": "address",
          "name": "contract_addr",
          "indexed": true
        }
      ],
      "anonymous": false,
      "type": "event"
    },
    {
      "name": "Payment",
      "inputs": [
        {
          "type": "uint256",
          "name": "amount",
          "indexed": false,
          "unit": "wei"
        },
        {
          "type": "address",
          "name": "source",
          "indexed": true
        }
      ],
      "anonymous": false,
      "type": "event"
    },
    {
      "name": "Transfer",
      "inputs": [
        {
          "type": "address",
          "name": "_from",
          "indexed": true
        },
        {
          "type": "address",
          "name": "_to",
          "indexed": true
        },
        {
          "type": "uint256",
          "name": "_value",
          "indexed": false
        }
      ],
      "anonymous": false,
      "type": "event"
    },
    {
      "name": "Approval",
      "inputs": [
        {
          "type": "address",
          "name": "_owner",
          "indexed": true
        },
        {
          "type": "address",
          "name": "_spender",
          "indexed": true
        },
        {
          "type": "uint256",
          "name": "_value",
          "indexed": false
        }
      ],
      "anonymous": false,
      "type": "event"
    },
    {
      "constant": false,
      "payable": true,
      "type": "fallback"
    },
    {
      "name": "setup",
      "outputs": [],
      "inputs": [
        {
          "type": "string",
          "name": "_name"
        },
        {
          "type": "string",
          "name": "_symbol"
        },
        {
          "type": "uint256",
          "name": "_ratio"
        },
        {
          "type": "address",
          "name": "_strikeAsset_address"
        },
        {
          "type": "address",
          "name": "_underlyingAsset_address"
        },
        {
          "type": "uint256[4]",
          "name": "_set"
        }
      ],
      "constant": false,
      "payable": false,
      "type": "function",
      "gas": 640323
    },
    {
      "name": "totalSupply",
      "outputs": [
        {
          "type": "uint256",
          "name": "out"
        }
      ],
      "inputs": [],
      "constant": true,
      "payable": false,
      "type": "function",
      "gas": 581
    },
    {
      "name": "allowance",
      "outputs": [
        {
          "type": "uint256",
          "name": "out"
        }
      ],
      "inputs": [
        {
          "type": "address",
          "name": "_owner"
        },
        {
          "type": "address",
          "name": "_spender"
        }
      ],
      "constant": true,
      "payable": false,
      "type": "function",
      "gas": 919
    },
    {
      "name": "transfer",
      "outputs": [
        {
          "type": "bool",
          "name": "out"
        }
      ],
      "inputs": [
        {
          "type": "address",
          "name": "_to"
        },
        {
          "type": "uint256",
          "name": "_value"
        }
      ],
      "constant": false,
      "payable": false,
      "type": "function",
      "gas": 73602
    },
    {
      "name": "transferFrom",
      "outputs": [
        {
          "type": "bool",
          "name": "out"
        }
      ],
      "inputs": [
        {
          "type": "address",
          "name": "_from"
        },
        {
          "type": "address",
          "name": "_to"
        },
        {
          "type": "uint256",
          "name": "_value"
        }
      ],
      "constant": false,
      "payable": false,
      "type": "function",
      "gas": 109296
    },
    {
      "name": "approve",
      "outputs": [
        {
          "type": "bool",
          "name": "out"
        }
      ],
      "inputs": [
        {
          "type": "address",
          "name": "_spender"
        },
        {
          "type": "uint256",
          "name": "_value"
        }
      ],
      "constant": false,
      "payable": false,
      "type": "function",
      "gas": 37883
    },
    {
      "name": "burn",
      "outputs": [],
      "inputs": [
        {
          "type": "uint256",
          "name": "_value"
        }
      ],
      "constant": false,
      "payable": false,
      "type": "function",
      "gas": 74405
    },
    {
      "name": "burnFrom",
      "outputs": [],
      "inputs": [
        {
          "type": "address",
          "name": "_to"
        },
        {
          "type": "uint256",
          "name": "_value"
        }
      ],
      "constant": false,
      "payable": false,
      "type": "function",
      "gas": 110095
    },
    {
      "name": "isMature",
      "outputs": [
        {
          "type": "bool",
          "name": "out"
        }
      ],
      "inputs": [],
      "constant": false,
      "payable": false,
      "type": "function",
      "gas": 37781
    },
    {
      "name": "write",
      "outputs": [
        {
          "type": "bool",
          "name": "out"
        }
      ],
      "inputs": [
        {
          "type": "uint256",
          "name": "deposit"
        }
      ],
      "constant": false,
      "payable": true,
      "type": "function",
      "gas": 293074
    },
    {
      "name": "close",
      "outputs": [
        {
          "type": "bool",
          "name": "out"
        }
      ],
      "inputs": [
        {
          "type": "uint256",
          "name": "amount"
        }
      ],
      "constant": false,
      "payable": true,
      "type": "function",
      "gas": 117420
    },
    {
      "name": "exercise",
      "outputs": [
        {
          "type": "bool",
          "name": "out"
        }
      ],
      "inputs": [
        {
          "type": "uint256",
          "name": "amount"
        }
      ],
      "constant": false,
      "payable": true,
      "type": "function",
      "gas": 2743395
    },
    {
      "name": "expire",
      "outputs": [
        {
          "type": "bool",
          "name": "out"
        }
      ],
      "inputs": [],
      "constant": false,
      "payable": false,
      "type": "function",
      "gas": 27909026
    },
    {
      "name": "factory",
      "outputs": [
        {
          "type": "address",
          "unit": "Factory",
          "name": "out"
        }
      ],
      "inputs": [],
      "constant": true,
      "payable": false,
      "type": "function",
      "gas": 1001
    },
    {
      "name": "strikeAsset",
      "outputs": [
        {
          "type": "address",
          "unit": "StrikeAsset",
          "name": "out"
        }
      ],
      "inputs": [],
      "constant": true,
      "payable": false,
      "type": "function",
      "gas": 1031
    },
    {
      "name": "underlyingAsset",
      "outputs": [
        {
          "type": "address",
          "unit": "UnderlyingAsset",
          "name": "out"
        }
      ],
      "inputs": [],
      "constant": true,
      "payable": false,
      "type": "function",
      "gas": 1061
    },
    {
      "name": "wax",
      "outputs": [
        {
          "type": "address",
          "unit": "Wax",
          "name": "out"
        }
      ],
      "inputs": [],
      "constant": true,
      "payable": false,
      "type": "function",
      "gas": 1091
    },
    {
      "name": "admin",
      "outputs": [
        {
          "type": "address",
          "name": "out"
        }
      ],
      "inputs": [],
      "constant": true,
      "payable": false,
      "type": "function",
      "gas": 1121
    },
    {
      "name": "strike",
      "outputs": [
        {
          "type": "uint256",
          "name": "out"
        }
      ],
      "inputs": [],
      "constant": true,
      "payable": false,
      "type": "function",
      "gas": 1151
    },
    {
      "name": "underlying",
      "outputs": [
        {
          "type": "uint256",
          "name": "out"
        }
      ],
      "inputs": [],
      "constant": true,
      "payable": false,
      "type": "function",
      "gas": 1181
    },
    {
      "name": "maturity",
      "outputs": [
        {
          "type": "uint256",
          "unit": "sec",
          "name": "out"
        }
      ],
      "inputs": [],
      "constant": true,
      "payable": false,
      "type": "function",
      "gas": 1211
    },
    {
      "name": "premium",
      "outputs": [
        {
          "type": "uint256",
          "name": "out"
        }
      ],
      "inputs": [],
      "constant": true,
      "payable": false,
      "type": "function",
      "gas": 1241
    },
    {
      "name": "expired",
      "outputs": [
        {
          "type": "bool",
          "name": "out"
        }
      ],
      "inputs": [],
      "constant": true,
      "payable": false,
      "type": "function",
      "gas": 1271
    },
    {
      "name": "name",
      "outputs": [
        {
          "type": "string",
          "name": "out"
        }
      ],
      "inputs": [],
      "constant": true,
      "payable": false,
      "type": "function",
      "gas": 5903
    },
    {
      "name": "symbol",
      "outputs": [
        {
          "type": "string",
          "name": "out"
        }
      ],
      "inputs": [],
      "constant": true,
      "payable": false,
      "type": "function",
      "gas": 5933
    },
    {
      "name": "decimals",
      "outputs": [
        {
          "type": "uint256",
          "name": "out"
        }
      ],
      "inputs": [],
      "constant": true,
      "payable": false,
      "type": "function",
      "gas": 1361
    },
    {
      "name": "balanceOf",
      "outputs": [
        {
          "type": "uint256",
          "name": "out"
        }
      ],
      "inputs": [
        {
          "type": "address",
          "name": "arg0"
        }
      ],
      "constant": true,
      "payable": false,
      "type": "function",
      "gas": 1545
    },
    {
      "name": "total_supply",
      "outputs": [
        {
          "type": "uint256",
          "name": "out"
        }
      ],
      "inputs": [],
      "constant": true,
      "payable": false,
      "type": "function",
      "gas": 1421
    },
    {
      "name": "minter",
      "outputs": [
        {
          "type": "address",
          "name": "out"
        }
      ],
      "inputs": [],
      "constant": true,
      "payable": false,
      "type": "function",
      "gas": 1451
    },
    {
      "name": "set",
      "outputs": [
        {
          "type": "uint256",
          "unit": "sec",
          "name": "out"
        }
      ],
      "inputs": [
        {
          "type": "int128",
          "name": "arg0"
        }
      ],
      "constant": true,
      "payable": false,
      "type": "function",
      "gas": 1680
    },
    {
      "name": "lockBook__locks__user",
      "outputs": [
        {
          "type": "address",
          "name": "out"
        }
      ],
      "inputs": [
        {
          "type": "uint256",
          "name": "arg0"
        }
      ],
      "constant": true,
      "payable": false,
      "type": "function",
      "gas": 1770
    },
    {
      "name": "lockBook__locks__underlying_amount",
      "outputs": [
        {
          "type": "uint256",
          "name": "out"
        }
      ],
      "inputs": [
        {
          "type": "uint256",
          "name": "arg0"
        }
      ],
      "constant": true,
      "payable": false,
      "type": "function",
      "gas": 1806
    },
    {
      "name": "lockBook__lock_key",
      "outputs": [
        {
          "type": "uint256",
          "name": "out"
        }
      ],
      "inputs": [],
      "constant": true,
      "payable": false,
      "type": "function",
      "gas": 1649
    },
    {
      "name": "lockBook__lock_length",
      "outputs": [
        {
          "type": "uint256",
          "name": "out"
        }
      ],
      "inputs": [],
      "constant": true,
      "payable": false,
      "type": "function",
      "gas": 1679
    },
    {
      "name": "lockBook__highest_lock",
      "outputs": [
        {
          "type": "uint256",
          "name": "out"
        }
      ],
      "inputs": [],
      "constant": true,
      "payable": false,
      "type": "function",
      "gas": 1709
    },
    {
      "name": "highest_key",
      "outputs": [
        {
          "type": "uint256",
          "name": "out"
        }
      ],
      "inputs": [],
      "constant": true,
      "payable": false,
      "type": "function",
      "gas": 1661
    },
    {
      "name": "user_to_key",
      "outputs": [
        {
          "type": "uint256",
          "name": "out"
        }
      ],
      "inputs": [
        {
          "type": "address",
          "name": "arg0"
        }
      ],
      "constant": true,
      "payable": false,
      "type": "function",
      "gas": 1845
    }
  ],
  "bytecode": "0x611d1356600436101561000d57611ce1565b600035601c52740100000000000000000000000000000000000000006020526f7fffffffffffffffffffffffffffffff6040527fffffffffffffffffffffffffffffffff8000000000000000000000000000000060605274012a05f1fffffffffffffffffffffffffdabf41c006080527ffffffffffffffffffffffffed5fa0e000000000000000000000000000000000060a05263d73abe8e60005114156102a75734156100ba57600080fd5b60606004356004016101403760406004356004013511156100da57600080fd5b60606024356004016101c03760406024356004013511156100fa57600080fd5b606435602051811061010b57600080fd5b50608435602051811061011d57600080fd5b5060003314156004541560005415161661013657600080fd5b3360005533600455601160c052602060c02060a480358255806020013560018301558060400135600283015580606001356003830155505060643560015560843560025561014080600a60c052602060c020602082510161012060006003818352015b826101205160200211156101ac576101ce565b61012051602002850151610120518501555b8151600101808352811415610199575b5050505050506101c080600b60c052602060c020602082510161012060006003818352015b8261012051602002111561020657610228565b61012051602002850151610120518501555b81516001018083528114156101f3575b505050505050670de0b6b3a7640000600c556000600d3360e05260c052604060c020556000600f55336010556000610240523360007fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef6020610240a333601260c052602060c020600060e05260c052604060c02060c052602060c02055005b6318160ddd60005114156102ce5734156102c057600080fd5b600f5460005260206000f350005b63dd62ed3e60005114156103355734156102e757600080fd5b60043560205181106102f857600080fd5b50602435602051811061030a57600080fd5b50600e60043560e05260c052604060c02060243560e05260c052604060c0205460005260206000f350005b63a9059cbb60005114156103f757341561034e57600080fd5b600435602051811061035f57600080fd5b50600d3360e05260c052604060c02080546024358082101561038057600080fd5b80820390509050815550600d60043560e05260c052604060c02080546024358181830110156103ae57600080fd5b8082019050905081555060243561014052600435337fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef6020610140a3600160005260206000f350005b6323b872dd600051141561050757341561041057600080fd5b600435602051811061042157600080fd5b50602435602051811061043357600080fd5b50600d60043560e05260c052604060c02080546044358082101561045657600080fd5b80820390509050815550600d60243560e05260c052604060c020805460443581818301101561048457600080fd5b80820190509050815550600e60043560e05260c052604060c0203360e05260c052604060c0208054604435808210156104bc57600080fd5b80820390509050815550604435610140526024356004357fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef6020610140a3600160005260206000f350005b63095ea7b3600051141561059157341561052057600080fd5b600435602051811061053157600080fd5b50602435600e3360e05260c052604060c02060043560e05260c052604060c0205560243561014052600435337f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b9256020610140a3600160005260206000f350005b600015610641575b610180526101405261016052600061014051186105b557600080fd5b600f8054610160518181830110156105cc57600080fd5b80820190509050815550600d6101405160e05260c052604060c0208054610160518181830110156105fc57600080fd5b80820190509050815550610160516101a0526101405160007fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef60206101a0a361018051565b6000156106ed575b6101805261014052610160526000610140511861066557600080fd5b600f8054610160518082101561067a57600080fd5b80820390509050815550600d6101405160e05260c052604060c020805461016051808210156106a857600080fd5b80820390509050815550610160516101a0526000610140517fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef60206101a0a361018051565b6342966c68600051141561073157341561070657600080fd5b636161eb1861014052336101605260043561018052610180516101605160065801610649565b600050005b6379cc679060005114156107c157341561074a57600080fd5b600435602051811061075b57600080fd5b50600e60043560e05260c052604060c0203360e05260c052604060c02080546024358082101561078a57600080fd5b80820390509050815550636161eb18610140526004356101605260243561018052610180516101605160065801610649565b600050005b63ae4e7fdf60005114156108355734156107da57600080fd5b6003543b6107e757600080fd5b60035430186107f557600080fd5b60206101c060246307757be1610140526007546101605261015c6003545afa61081d57600080fd5b6000506101c05160095560095460005260206000f350005b632f048afa6000511415610b0957600061014052600060143360e05260c052604060c0205411156108ba5760143360e05260c052604060c02054610140526001601260c052602060c0206101405160e05260c052604060c02060c052602060c0200180546004358181830110156108ab57600080fd5b8082019050905081555061094f565b6002601260c052602060c020015460018181830110156108d957600080fd5b80820190509050610140526002601260c052602060c020018054600181818301101561090457600080fd5b808201905090508155506101405160143360e05260c052604060c02055601260c052602060c0206101405160e05260c052604060c02060c052602060c0203381556004356001820155505b6003601260c052602060c02001546001601260c052602060c0206101405160e05260c052604060c02060c052602060c020015411156109c3576001601260c052602060c0206101405160e05260c052604060c02060c052602060c02001546003601260c052602060c0200155610140516013555b600435600c5480820282158284830414176109dd57600080fd5b8090509050905060065480806109f257600080fd5b820490509050610160526002543b610a0957600080fd5b6002543018610a1757600080fd5b602061024060646323b872dd61018052336101a052306101c0526004356101e05261019c60006002545af1610a4b57600080fd5b600050610240506101405161016051610180516101a0516101c0516101e0516102005161022051610240516340c10f1961028052336102a052610160516102c0526102c0516102a05160065801610599565b6102405261022052610200526101e0526101c0526101a05261018052610160526101405260005061016051610320526101405161034052337f33d8dc4a860afa0606947f2b214f16e21e7eac41e3eb6642e859d9626d002ef66040610320a2600160005260206000f350005b630aebeb4e6000511415610d155760143360e05260c052604060c02054610140526006546004358082028215828483041417610b4457600080fd5b80905090509050600c548080610b5957600080fd5b82049050905061016052610160516001601260c052602060c0206101405160e05260c052604060c02060c052602060c02001541015610b9757600080fd5b600435600d3360e05260c052604060c020541015610bb457600080fd5b6001601260c052602060c0206101405160e05260c052604060c02060c052602060c0200180546101605180821015610beb57600080fd5b808203905090508155506002543b610c0257600080fd5b6002543018610c1057600080fd5b6020610220604463a9059cbb61018052336101a052610160516101c05261019c60006002545af1610c4057600080fd5b600050610220506101405161016051610180516101a0516101c0516101e0516102005161022051636161eb186102605233610280526004356102a0526102a0516102805160065801610649565b61022052610200526101e0526101c0526101a052610180526101605261014052600050600435610300526101405161032052601260c052602060c0206101405160e05260c052604060c02060c052602060c020547f9d801553d397b8274b513890b6fc73f1a5edcf9ab99ee408d64b6e36889433e06040610300a2600160005260206000f350005b63b07f0a41600051141561154857600435600d3360e05260c052604060c020541015610d4057600080fd5b6005546004358082028215828483041417610d5a57600080fd5b80905090509050600c548080610d6f57600080fd5b820490509050610140526006546004358082028215828483041417610d9357600080fd5b80905090509050600c548080610da857600080fd5b820490509050610160526001543b610dbf57600080fd5b6001543018610dcd57600080fd5b602061024060646323b872dd61018052336101a052306101c052610140516101e05261019c60006001545af1610e0257600080fd5b600050610240506002543b610e1657600080fd5b6002543018610e2457600080fd5b6020610300604463a9059cbb610260523361028052610160516102a05261027c60006002545af1610e5457600080fd5b6000506103005060006103205260006103405261036060016103ff818352015b610360516000811215610e8657600080fd5b61034052610160516003601260c052602060c02001541115610ed357601260c052602060c02060135460e05260c052604060c02060c052602060c020546103205260135461034052610f3e565b610160516001601260c052602060c0206103405160e05260c052604060c02060c052602060c02001541115610f2d57601260c052602060c0206103405160e05260c052604060c02060c052602060c0205461032052610f3e565b5b8151600101808352811415610e74575b50506103205115156113f05761038060016002818352015b610380516000811215610f6857600080fd5b61034052601260c052602060c0206103405160e05260c052604060c02060c052602060c020546103a0526001601260c052602060c0206103405160e05260c052604060c02060c052602060c02001546103c0526103c051600c548082028215828483041417610fd657600080fd5b809050905090506006548080610feb57600080fd5b8204905090506103e052610160516103c051111561102e57601260c052602060c0206103405160e05260c052604060c02060c052602060c0205461032052611229565b6103a051151561107957601260c052602060c0206103405160018082101561105557600080fd5b8082039050905060e05260c052604060c02060c052602060c020546103a052611229565b6001543b61108657600080fd5b600154301861109457600080fd5b60206104a0604463a9059cbb610400526103a05161042052600554600c5480806110bd57600080fd5b8204905090506103e05180820282158284830414176110db57600080fd5b809050905090506104405261041c60006001545af16110f957600080fd5b6000506104a05061016080516103c0518082101561111657600080fd5b808203905090508152506103e0516104c052610340516104e052337f7fb8af33a94ca7bd709d59757a015eb48270f350724a5409fd77b579d0b7247d60406104c0a2610140610500525b6105005151602061050051016105005261050061050051101561118257611160565b636161eb186105205233610540526103e05161056052610560516105405160065801610649565b6104e0610500525b61050051526020610500510361050052610140610500511015156111d4576111b1565b6000506001601260c052602060c0206103405160e05260c052604060c02060c052602060c0200180546103c0518082101561120e57600080fd5b808203905090508155505b8151600101808352811415610f56575b50506001543b61123857600080fd5b600154301861124657600080fd5b6020610660604463a9059cbb6105c052610320516105e052600554600654808061126f57600080fd5b82049050905061016051808202821582848304141761128d57600080fd5b80905090509050610600526105dc60006001545af16112ab57600080fd5b600050610660506101605160065480806112c457600080fd5b820490509050600c5480820282158284830414176112e157600080fd5b8090509050905061068052610680516106a052610340516106c052337f7fb8af33a94ca7bd709d59757a015eb48270f350724a5409fd77b579d0b7247d60406106a0a26101406106e0525b6106e0515160206106e051016106e0526106e06106e051101561134e5761132c565b636161eb186107005233610720526106805161074052610740516107205160065801610649565b6106c06106e0525b6106e0515260206106e051036106e0526101406106e0511015156113a05761137d565b6000506001601260c052602060c0206103405160e05260c052604060c02060c052602060c02001805461016051808210156113da57600080fd5b80820390509050815550600160005260206000f3505b6001543b6113fd57600080fd5b600154301861140b57600080fd5b6020610840604463a9059cbb6107a052610320516107c052610140516107e0526107bc60006001545af161143e57600080fd5b600050610840506001601260c052602060c0206103405160e05260c052604060c02060c052602060c020018054610160518082101561147c57600080fd5b80820390509050815550600435610860526103405161088052337f7fb8af33a94ca7bd709d59757a015eb48270f350724a5409fd77b579d0b7247d6040610860a26101406108a0525b6108a0515160206108a051016108a0526108a06108a05110156114e7576114c5565b636161eb186108c052336108e05260043561090052610900516108e05160065801610649565b6108806108a0525b6108a0515260206108a051036108a0526101406108a05110151561153857611515565b600050600160005260206000f350005b6379599f96600051141561174057341561156157600080fd5b600160095560095461157257600080fd5b60016101405261016060016103fe818352015b601260c052602060c0206101605160008112156115a157600080fd5b60e05260c052604060c02060c052602060c0205415156115c05761172c565b6101605160008112156115d257600080fd5b610140526001601260c052602060c0206101405160e05260c052604060c02060c052602060c020015461018052601260c052602060c0206101405160e05260c052604060c02060c052602060c020546101a0526000610180511115611687576002543b61163e57600080fd5b600254301861164c57600080fd5b6020610260604463a9059cbb6101c0526101a0516101e05261018051610200526101dc60006002545af161167f57600080fd5b600050610260505b60006001601260c052602060c0206101405160e05260c052604060c02060c052602060c02001556101805160065480806116c057600080fd5b820490509050600c5480820282158284830414176116dd57600080fd5b8090509050905061028052610140516102a0526101a0517f9d801553d397b8274b513890b6fc73f1a5edcf9ab99ee408d64b6e36889433e06040610280a25b8151600101808352811415611585575b50506000600f55600160005260206000f350005b63c45a0155600051141561176757341561175957600080fd5b60005460005260206000f350005b6317d69bc8600051141561178e57341561178057600080fd5b60015460005260206000f350005b637158da7c60005114156117b55734156117a757600080fd5b60025460005260206000f350005b639c550e8160005114156117dc5734156117ce57600080fd5b60035460005260206000f350005b63f851a44060005114156118035734156117f557600080fd5b60045460005260206000f350005b63ad8f5008600051141561182a57341561181c57600080fd5b60055460005260206000f350005b636f307dc3600051141561185157341561184357600080fd5b60065460005260206000f350005b63204f83f9600051141561187857341561186a57600080fd5b60075460005260206000f350005b63e0a73a93600051141561189f57341561189157600080fd5b60085460005260206000f350005b634c2067c760005114156118c65734156118b857600080fd5b60095460005260206000f350005b6306fdde03600051141561197a5734156118df57600080fd5b600a8060c052602060c020610180602082540161012060006003818352015b8261012051602002111561191157611933565b61012051850154610120516020028501525b81516001018083528114156118fe575b50505050505061018051806101a001818260206001820306601f82010390500336823750506020610160526040610180510160206001820306601f8201039050610160f350005b6395d89b416000511415611a2e57341561199357600080fd5b600b8060c052602060c020610180602082540161012060006003818352015b826101205160200211156119c5576119e7565b61012051850154610120516020028501525b81516001018083528114156119b2575b50505050505061018051806101a001818260206001820306601f82010390500336823750506020610160526040610180510160206001820306601f8201039050610160f350005b63313ce5676000511415611a55573415611a4757600080fd5b600c5460005260206000f350005b6370a082316000511415611a9c573415611a6e57600080fd5b6004356020518110611a7f57600080fd5b50600d60043560e05260c052604060c0205460005260206000f350005b633940e9ee6000511415611ac3573415611ab557600080fd5b600f5460005260206000f350005b63075461726000511415611aea573415611adc57600080fd5b60105460005260206000f350005b63795313b06000511415611b4f573415611b0357600080fd5b60605160043580604051901315611b1957600080fd5b8091901215611b2757600080fd5b5060043560048110611b3857600080fd5b601160c052602060c020015460005260206000f350005b633d32d1116000511415611b94573415611b6857600080fd5b601260c052602060c02060043560e05260c052604060c02060c052602060c0205460005260206000f350005b6394f2196b6000511415611bdc573415611bad57600080fd5b6001601260c052602060c02060043560e05260c052604060c02060c052602060c020015460005260206000f350005b631958e1f06000511415611c0e573415611bf557600080fd5b6001601260c052602060c020015460005260206000f350005b63e6b316f06000511415611c40573415611c2757600080fd5b6002601260c052602060c020015460005260206000f350005b637047a0566000511415611c72573415611c5957600080fd5b6003601260c052602060c020015460005260206000f350005b63760a11c16000511415611c99573415611c8b57600080fd5b60135460005260206000f350005b63dd6b337f6000511415611ce0573415611cb257600080fd5b6004356020518110611cc357600080fd5b50601460043560e05260c052604060c0205460005260206000f350005b5b3461014052337ff817bef87c74de34ab725f43b121c1dff5324aa363f7b9ac176b9aee5115230e6020610140a25b610004611d1303610004600039610004611d13036000f3",
  "deployedBytecode": "0x600436101561000d57611ce1565b600035601c52740100000000000000000000000000000000000000006020526f7fffffffffffffffffffffffffffffff6040527fffffffffffffffffffffffffffffffff8000000000000000000000000000000060605274012a05f1fffffffffffffffffffffffffdabf41c006080527ffffffffffffffffffffffffed5fa0e000000000000000000000000000000000060a05263d73abe8e60005114156102a75734156100ba57600080fd5b60606004356004016101403760406004356004013511156100da57600080fd5b60606024356004016101c03760406024356004013511156100fa57600080fd5b606435602051811061010b57600080fd5b50608435602051811061011d57600080fd5b5060003314156004541560005415161661013657600080fd5b3360005533600455601160c052602060c02060a480358255806020013560018301558060400135600283015580606001356003830155505060643560015560843560025561014080600a60c052602060c020602082510161012060006003818352015b826101205160200211156101ac576101ce565b61012051602002850151610120518501555b8151600101808352811415610199575b5050505050506101c080600b60c052602060c020602082510161012060006003818352015b8261012051602002111561020657610228565b61012051602002850151610120518501555b81516001018083528114156101f3575b505050505050670de0b6b3a7640000600c556000600d3360e05260c052604060c020556000600f55336010556000610240523360007fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef6020610240a333601260c052602060c020600060e05260c052604060c02060c052602060c02055005b6318160ddd60005114156102ce5734156102c057600080fd5b600f5460005260206000f350005b63dd62ed3e60005114156103355734156102e757600080fd5b60043560205181106102f857600080fd5b50602435602051811061030a57600080fd5b50600e60043560e05260c052604060c02060243560e05260c052604060c0205460005260206000f350005b63a9059cbb60005114156103f757341561034e57600080fd5b600435602051811061035f57600080fd5b50600d3360e05260c052604060c02080546024358082101561038057600080fd5b80820390509050815550600d60043560e05260c052604060c02080546024358181830110156103ae57600080fd5b8082019050905081555060243561014052600435337fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef6020610140a3600160005260206000f350005b6323b872dd600051141561050757341561041057600080fd5b600435602051811061042157600080fd5b50602435602051811061043357600080fd5b50600d60043560e05260c052604060c02080546044358082101561045657600080fd5b80820390509050815550600d60243560e05260c052604060c020805460443581818301101561048457600080fd5b80820190509050815550600e60043560e05260c052604060c0203360e05260c052604060c0208054604435808210156104bc57600080fd5b80820390509050815550604435610140526024356004357fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef6020610140a3600160005260206000f350005b63095ea7b3600051141561059157341561052057600080fd5b600435602051811061053157600080fd5b50602435600e3360e05260c052604060c02060043560e05260c052604060c0205560243561014052600435337f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b9256020610140a3600160005260206000f350005b600015610641575b610180526101405261016052600061014051186105b557600080fd5b600f8054610160518181830110156105cc57600080fd5b80820190509050815550600d6101405160e05260c052604060c0208054610160518181830110156105fc57600080fd5b80820190509050815550610160516101a0526101405160007fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef60206101a0a361018051565b6000156106ed575b6101805261014052610160526000610140511861066557600080fd5b600f8054610160518082101561067a57600080fd5b80820390509050815550600d6101405160e05260c052604060c020805461016051808210156106a857600080fd5b80820390509050815550610160516101a0526000610140517fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef60206101a0a361018051565b6342966c68600051141561073157341561070657600080fd5b636161eb1861014052336101605260043561018052610180516101605160065801610649565b600050005b6379cc679060005114156107c157341561074a57600080fd5b600435602051811061075b57600080fd5b50600e60043560e05260c052604060c0203360e05260c052604060c02080546024358082101561078a57600080fd5b80820390509050815550636161eb18610140526004356101605260243561018052610180516101605160065801610649565b600050005b63ae4e7fdf60005114156108355734156107da57600080fd5b6003543b6107e757600080fd5b60035430186107f557600080fd5b60206101c060246307757be1610140526007546101605261015c6003545afa61081d57600080fd5b6000506101c05160095560095460005260206000f350005b632f048afa6000511415610b0957600061014052600060143360e05260c052604060c0205411156108ba5760143360e05260c052604060c02054610140526001601260c052602060c0206101405160e05260c052604060c02060c052602060c0200180546004358181830110156108ab57600080fd5b8082019050905081555061094f565b6002601260c052602060c020015460018181830110156108d957600080fd5b80820190509050610140526002601260c052602060c020018054600181818301101561090457600080fd5b808201905090508155506101405160143360e05260c052604060c02055601260c052602060c0206101405160e05260c052604060c02060c052602060c0203381556004356001820155505b6003601260c052602060c02001546001601260c052602060c0206101405160e05260c052604060c02060c052602060c020015411156109c3576001601260c052602060c0206101405160e05260c052604060c02060c052602060c02001546003601260c052602060c0200155610140516013555b600435600c5480820282158284830414176109dd57600080fd5b8090509050905060065480806109f257600080fd5b820490509050610160526002543b610a0957600080fd5b6002543018610a1757600080fd5b602061024060646323b872dd61018052336101a052306101c0526004356101e05261019c60006002545af1610a4b57600080fd5b600050610240506101405161016051610180516101a0516101c0516101e0516102005161022051610240516340c10f1961028052336102a052610160516102c0526102c0516102a05160065801610599565b6102405261022052610200526101e0526101c0526101a05261018052610160526101405260005061016051610320526101405161034052337f33d8dc4a860afa0606947f2b214f16e21e7eac41e3eb6642e859d9626d002ef66040610320a2600160005260206000f350005b630aebeb4e6000511415610d155760143360e05260c052604060c02054610140526006546004358082028215828483041417610b4457600080fd5b80905090509050600c548080610b5957600080fd5b82049050905061016052610160516001601260c052602060c0206101405160e05260c052604060c02060c052602060c02001541015610b9757600080fd5b600435600d3360e05260c052604060c020541015610bb457600080fd5b6001601260c052602060c0206101405160e05260c052604060c02060c052602060c0200180546101605180821015610beb57600080fd5b808203905090508155506002543b610c0257600080fd5b6002543018610c1057600080fd5b6020610220604463a9059cbb61018052336101a052610160516101c05261019c60006002545af1610c4057600080fd5b600050610220506101405161016051610180516101a0516101c0516101e0516102005161022051636161eb186102605233610280526004356102a0526102a0516102805160065801610649565b61022052610200526101e0526101c0526101a052610180526101605261014052600050600435610300526101405161032052601260c052602060c0206101405160e05260c052604060c02060c052602060c020547f9d801553d397b8274b513890b6fc73f1a5edcf9ab99ee408d64b6e36889433e06040610300a2600160005260206000f350005b63b07f0a41600051141561154857600435600d3360e05260c052604060c020541015610d4057600080fd5b6005546004358082028215828483041417610d5a57600080fd5b80905090509050600c548080610d6f57600080fd5b820490509050610140526006546004358082028215828483041417610d9357600080fd5b80905090509050600c548080610da857600080fd5b820490509050610160526001543b610dbf57600080fd5b6001543018610dcd57600080fd5b602061024060646323b872dd61018052336101a052306101c052610140516101e05261019c60006001545af1610e0257600080fd5b600050610240506002543b610e1657600080fd5b6002543018610e2457600080fd5b6020610300604463a9059cbb610260523361028052610160516102a05261027c60006002545af1610e5457600080fd5b6000506103005060006103205260006103405261036060016103ff818352015b610360516000811215610e8657600080fd5b61034052610160516003601260c052602060c02001541115610ed357601260c052602060c02060135460e05260c052604060c02060c052602060c020546103205260135461034052610f3e565b610160516001601260c052602060c0206103405160e05260c052604060c02060c052602060c02001541115610f2d57601260c052602060c0206103405160e05260c052604060c02060c052602060c0205461032052610f3e565b5b8151600101808352811415610e74575b50506103205115156113f05761038060016002818352015b610380516000811215610f6857600080fd5b61034052601260c052602060c0206103405160e05260c052604060c02060c052602060c020546103a0526001601260c052602060c0206103405160e05260c052604060c02060c052602060c02001546103c0526103c051600c548082028215828483041417610fd657600080fd5b809050905090506006548080610feb57600080fd5b8204905090506103e052610160516103c051111561102e57601260c052602060c0206103405160e05260c052604060c02060c052602060c0205461032052611229565b6103a051151561107957601260c052602060c0206103405160018082101561105557600080fd5b8082039050905060e05260c052604060c02060c052602060c020546103a052611229565b6001543b61108657600080fd5b600154301861109457600080fd5b60206104a0604463a9059cbb610400526103a05161042052600554600c5480806110bd57600080fd5b8204905090506103e05180820282158284830414176110db57600080fd5b809050905090506104405261041c60006001545af16110f957600080fd5b6000506104a05061016080516103c0518082101561111657600080fd5b808203905090508152506103e0516104c052610340516104e052337f7fb8af33a94ca7bd709d59757a015eb48270f350724a5409fd77b579d0b7247d60406104c0a2610140610500525b6105005151602061050051016105005261050061050051101561118257611160565b636161eb186105205233610540526103e05161056052610560516105405160065801610649565b6104e0610500525b61050051526020610500510361050052610140610500511015156111d4576111b1565b6000506001601260c052602060c0206103405160e05260c052604060c02060c052602060c0200180546103c0518082101561120e57600080fd5b808203905090508155505b8151600101808352811415610f56575b50506001543b61123857600080fd5b600154301861124657600080fd5b6020610660604463a9059cbb6105c052610320516105e052600554600654808061126f57600080fd5b82049050905061016051808202821582848304141761128d57600080fd5b80905090509050610600526105dc60006001545af16112ab57600080fd5b600050610660506101605160065480806112c457600080fd5b820490509050600c5480820282158284830414176112e157600080fd5b8090509050905061068052610680516106a052610340516106c052337f7fb8af33a94ca7bd709d59757a015eb48270f350724a5409fd77b579d0b7247d60406106a0a26101406106e0525b6106e0515160206106e051016106e0526106e06106e051101561134e5761132c565b636161eb186107005233610720526106805161074052610740516107205160065801610649565b6106c06106e0525b6106e0515260206106e051036106e0526101406106e0511015156113a05761137d565b6000506001601260c052602060c0206103405160e05260c052604060c02060c052602060c02001805461016051808210156113da57600080fd5b80820390509050815550600160005260206000f3505b6001543b6113fd57600080fd5b600154301861140b57600080fd5b6020610840604463a9059cbb6107a052610320516107c052610140516107e0526107bc60006001545af161143e57600080fd5b600050610840506001601260c052602060c0206103405160e05260c052604060c02060c052602060c020018054610160518082101561147c57600080fd5b80820390509050815550600435610860526103405161088052337f7fb8af33a94ca7bd709d59757a015eb48270f350724a5409fd77b579d0b7247d6040610860a26101406108a0525b6108a0515160206108a051016108a0526108a06108a05110156114e7576114c5565b636161eb186108c052336108e05260043561090052610900516108e05160065801610649565b6108806108a0525b6108a0515260206108a051036108a0526101406108a05110151561153857611515565b600050600160005260206000f350005b6379599f96600051141561174057341561156157600080fd5b600160095560095461157257600080fd5b60016101405261016060016103fe818352015b601260c052602060c0206101605160008112156115a157600080fd5b60e05260c052604060c02060c052602060c0205415156115c05761172c565b6101605160008112156115d257600080fd5b610140526001601260c052602060c0206101405160e05260c052604060c02060c052602060c020015461018052601260c052602060c0206101405160e05260c052604060c02060c052602060c020546101a0526000610180511115611687576002543b61163e57600080fd5b600254301861164c57600080fd5b6020610260604463a9059cbb6101c0526101a0516101e05261018051610200526101dc60006002545af161167f57600080fd5b600050610260505b60006001601260c052602060c0206101405160e05260c052604060c02060c052602060c02001556101805160065480806116c057600080fd5b820490509050600c5480820282158284830414176116dd57600080fd5b8090509050905061028052610140516102a0526101a0517f9d801553d397b8274b513890b6fc73f1a5edcf9ab99ee408d64b6e36889433e06040610280a25b8151600101808352811415611585575b50506000600f55600160005260206000f350005b63c45a0155600051141561176757341561175957600080fd5b60005460005260206000f350005b6317d69bc8600051141561178e57341561178057600080fd5b60015460005260206000f350005b637158da7c60005114156117b55734156117a757600080fd5b60025460005260206000f350005b639c550e8160005114156117dc5734156117ce57600080fd5b60035460005260206000f350005b63f851a44060005114156118035734156117f557600080fd5b60045460005260206000f350005b63ad8f5008600051141561182a57341561181c57600080fd5b60055460005260206000f350005b636f307dc3600051141561185157341561184357600080fd5b60065460005260206000f350005b63204f83f9600051141561187857341561186a57600080fd5b60075460005260206000f350005b63e0a73a93600051141561189f57341561189157600080fd5b60085460005260206000f350005b634c2067c760005114156118c65734156118b857600080fd5b60095460005260206000f350005b6306fdde03600051141561197a5734156118df57600080fd5b600a8060c052602060c020610180602082540161012060006003818352015b8261012051602002111561191157611933565b61012051850154610120516020028501525b81516001018083528114156118fe575b50505050505061018051806101a001818260206001820306601f82010390500336823750506020610160526040610180510160206001820306601f8201039050610160f350005b6395d89b416000511415611a2e57341561199357600080fd5b600b8060c052602060c020610180602082540161012060006003818352015b826101205160200211156119c5576119e7565b61012051850154610120516020028501525b81516001018083528114156119b2575b50505050505061018051806101a001818260206001820306601f82010390500336823750506020610160526040610180510160206001820306601f8201039050610160f350005b63313ce5676000511415611a55573415611a4757600080fd5b600c5460005260206000f350005b6370a082316000511415611a9c573415611a6e57600080fd5b6004356020518110611a7f57600080fd5b50600d60043560e05260c052604060c0205460005260206000f350005b633940e9ee6000511415611ac3573415611ab557600080fd5b600f5460005260206000f350005b63075461726000511415611aea573415611adc57600080fd5b60105460005260206000f350005b63795313b06000511415611b4f573415611b0357600080fd5b60605160043580604051901315611b1957600080fd5b8091901215611b2757600080fd5b5060043560048110611b3857600080fd5b601160c052602060c020015460005260206000f350005b633d32d1116000511415611b94573415611b6857600080fd5b601260c052602060c02060043560e05260c052604060c02060c052602060c0205460005260206000f350005b6394f2196b6000511415611bdc573415611bad57600080fd5b6001601260c052602060c02060043560e05260c052604060c02060c052602060c020015460005260206000f350005b631958e1f06000511415611c0e573415611bf557600080fd5b6001601260c052602060c020015460005260206000f350005b63e6b316f06000511415611c40573415611c2757600080fd5b6002601260c052602060c020015460005260206000f350005b637047a0566000511415611c72573415611c5957600080fd5b6003601260c052602060c020015460005260206000f350005b63760a11c16000511415611c99573415611c8b57600080fd5b60135460005260206000f350005b63dd6b337f6000511415611ce0573415611cb257600080fd5b6004356020518110611cc357600080fd5b50601460043560e05260c052604060c0205460005260206000f350005b5b3461014052337ff817bef87c74de34ab725f43b121c1dff5324aa363f7b9ac176b9aee5115230e6020610140a2",
  "source": "# @title c.M.O.A.T: Call - Multilateral Optionality Asset Transfer\r\n# \r\n# @notice Implementation of a Tokenized Asset Transfer Agreement on the Ethereum Network\r\n# \r\n# @author Alexander Angel\r\n# \r\n# @dev Uses a factory to initialize and deploy MOAT templates\r\n#\r\n# @version 0.1.0b14\r\n\r\n\r\nfrom vyper.interfaces import ERC20\r\nimplements: ERC20\r\n\r\n\r\n# Structs\r\nstruct Account:\r\n    user: address\r\n    underlying_amount: uint256\r\n\r\n\r\nstruct LockBook:\r\n    locks: map(uint256, Account)\r\n    lock_key: uint256\r\n    lock_length: uint256\r\n    highest_lock: uint256\r\n\r\n\r\n# Interfaces\r\ncontract Factory():\r\n    def getDoz(user_addr: address) -> address:constant\r\n    def getUser(omn: address) -> address:constant\r\n\r\n\r\ncontract StrikeAsset():\r\n    def totalSupply() -> uint256:constant\r\n    def balanceOf(_owner: address) -> uint256:constant\r\n    def allowance(_owner: address, _spender: address) -> uint256:constant\r\n    def transfer(_to: address, _value: uint256) -> bool:modifying\r\n    def transferFrom(_from: address, _to: address, _value: uint256) -> bool:modifying\r\n    def approve(_spender: address, _value: uint256) -> bool:modifying\r\n\r\n\r\ncontract UnderlyingAsset():\r\n    def totalSupply() -> uint256:constant\r\n    def balanceOf(_owner: address) -> uint256:constant\r\n    def allowance(_owner: address, _spender: address) -> uint256:constant\r\n    def transfer(_to: address, _value: uint256) -> bool:modifying\r\n    def transferFrom(_from: address, _to: address, _value: uint256) -> bool:modifying\r\n    def approve(_spender: address, _value: uint256) -> bool:modifying\r\n\r\n\r\ncontract Wax():\r\n    def timeToExpiry(time: timestamp) -> bool:constant\r\n\r\n\r\n# Events\r\nWrite: event({_from: indexed(address), amount: uint256, key: uint256})\r\nExercise: event({_from: indexed(address), amount: uint256, key: uint256})\r\nClose: event({_from: indexed(address), amount: uint256, key: uint256})\r\nMature: event({contract_addr: indexed(address)})\r\nPayment: event({amount: wei_value, source: indexed(address)})\r\n\r\n\r\n# EIP-20 Events\r\nTransfer: event({_from: indexed(address), _to: indexed(address), _value: uint256})\r\nApproval: event({_owner: indexed(address), _spender: indexed(address), _value: uint256})\r\n\r\n\r\n# Interface Contracts\r\nfactory: public(Factory)\r\nstrikeAsset: public(StrikeAsset)\r\nunderlyingAsset: public(UnderlyingAsset)\r\nwax: public(Wax)\r\n\r\n\r\n# Administrator - For Early Versions ONLY\r\nadmin: public(address)\r\n\r\n\r\n# Contract specific parameters\r\nstrike: public(uint256) # Denominated in strike asset\r\nunderlying: public(uint256) # Denominated in underlying asset\r\nmaturity: public(timestamp) # UNIX Timestamp\r\npremium: public(uint256) # Temporary and initial value per MOAT token\r\nexpired: public(bool) # Expired MOAT tokens are worthless\r\n\r\n\r\n# EIP-20\r\nname: public(string[64])\r\nsymbol: public(string[64])\r\ndecimals: public(uint256)\r\nbalanceOf: public(map(address, uint256))\r\nallowances: map(address, map(address, uint256))\r\ntotal_supply: public(uint256)\r\nminter: public(address)\r\nset: public(timestamp[4])\r\n\r\n# User Claims\r\nlockBook: public(LockBook) # Struct for lists of underlying deposits\r\nhighest_key: public(uint256) # Largest underlying deposit respective key\r\nuser_to_key: public(map(address, uint256)) # Link users to their keys, 1 key per address\r\n\r\n\r\n# Constants\r\nMAX_KEY_LENGTH: constant(uint256) = 2**10-1 # Used for looping over the book\r\n\r\n\r\n@public\r\n@payable\r\ndef __default__():\r\n    log.Payment(msg.value, msg.sender)\r\n\r\n\r\n# Initializer\r\n@public\r\ndef setup(\r\n        _name: string[64],\r\n        _symbol: string[64],\r\n        _ratio: uint256,\r\n        _strikeAsset_address: address,\r\n        _underlyingAsset_address: address,\r\n        _set: timestamp[4]\r\n    ):\r\n    \"\"\"\r\n    @notice                         Setup is called from the factory contract using a contract template address\r\n    @param _name                    Name of this contract linked to its parameters\r\n    @param _symbol                  Naming convention to represent the paramers -> \r\n                                    Strike Symbol + Underlying Symbol + UNIX Timestamp + \r\n                                    Type (C or P) + # of Strike tokens per # of Underlying tokens\r\n    @param _ratio                   Strike:Underlying ratio \r\n    @param _strikeAsset_address     Address of strike asset contract\r\n    @param _underlyingAsst_address  Address of underlying asset contract\r\n    @param _set                     List of expiration times valid for contract\r\n    \"\"\"\r\n    assert(self.factory == ZERO_ADDRESS and self.admin == ZERO_ADDRESS) and msg.sender != ZERO_ADDRESS\r\n    \r\n    \r\n    # Administrative variables\r\n    self.factory = Factory(msg.sender)\r\n    self.admin = msg.sender\r\n    self.set = _set\r\n\r\n    # Interfaces\r\n    self.strikeAsset = StrikeAsset(_strikeAsset_address)\r\n    self.underlyingAsset = UnderlyingAsset(_underlyingAsset_address)\r\n\r\n    # EIP-20 Standard\r\n    self.name = _name\r\n    self.symbol = _symbol\r\n    self.decimals = 10**18\r\n    self.balanceOf[msg.sender] = 0\r\n    self.total_supply = 0\r\n    self.minter = msg.sender\r\n    log.Transfer(ZERO_ADDRESS, msg.sender, 0)\r\n\r\n    # Set first book account to admin\r\n    self.lockBook.locks[0].user = msg.sender\r\n\r\n\r\n# EIP-20 Functions - Source: https://github.com/ethereum/vyper/blob/master/examples/tokens/ERC20.vy\r\n@public\r\n@constant\r\ndef totalSupply() -> uint256:\r\n    \"\"\"\r\n    @dev Total number of tokens in existence.\r\n    \"\"\"\r\n    return self.total_supply\r\n\r\n@public\r\n@constant\r\ndef allowance(_owner : address, _spender : address) -> uint256:\r\n    \"\"\"\r\n    @dev Function to check the amount of tokens that an owner allowed to a spender.\r\n    @param _owner The address which owns the funds.\r\n    @param _spender The address which will spend the funds.\r\n    @return An uint256 specifying the amount of tokens still available for the spender.\r\n    \"\"\"\r\n    return self.allowances[_owner][_spender]\r\n\r\n\r\n@public\r\ndef transfer(_to : address, _value : uint256) -> bool:\r\n    \"\"\"\r\n    @dev Transfer token for a specified address\r\n    @param _to The address to transfer to.\r\n    @param _value The amount to be transferred.\r\n    \"\"\"\r\n    # NOTE: vyper does not allow underflows\r\n    #       so the following subtraction would revert on insufficient balance\r\n    self.balanceOf[msg.sender] -= _value\r\n    self.balanceOf[_to] += _value\r\n    log.Transfer(msg.sender, _to, _value)\r\n    return True\r\n\r\n\r\n@public\r\ndef transferFrom(_from : address, _to : address, _value : uint256) -> bool:\r\n    \"\"\"\r\n     @dev Transfer tokens from one address to another.\r\n          Note that while this function emits a Transfer event, this is not required as per the specification,\r\n          and other compliant implementations may not emit the event.\r\n     @param _from address The address which you want to send tokens from\r\n     @param _to address The address which you want to transfer to\r\n     @param _value uint256 the amount of tokens to be transferred\r\n    \"\"\"\r\n    # NOTE: vyper does not allow underflows\r\n    #       so the following subtraction would revert on insufficient balance\r\n    self.balanceOf[_from] -= _value\r\n    self.balanceOf[_to] += _value\r\n    # NOTE: vyper does not allow underflows\r\n    #      so the following subtraction would revert on insufficient allowance\r\n    self.allowances[_from][msg.sender] -= _value\r\n    log.Transfer(_from, _to, _value)\r\n    return True\r\n\r\n\r\n@public\r\ndef approve(_spender : address, _value : uint256) -> bool:\r\n    \"\"\"\r\n    @dev Approve the passed address to spend the specified amount of tokens on behalf of msg.sender.\r\n         Beware that changing an allowance with this method brings the risk that someone may use both the old\r\n         and the new allowance by unfortunate transaction ordering. One possible solution to mitigate this\r\n         race condition is to first reduce the spender's allowance to 0 and set the desired value afterwards:\r\n         https://github.com/ethereum/EIPs/issues/20#issuecomment-263524729\r\n    @param _spender The address which will spend the funds.\r\n    @param _value The amount of tokens to be spent.\r\n    \"\"\"\r\n    self.allowances[msg.sender][_spender] = _value\r\n    log.Approval(msg.sender, _spender, _value)\r\n    return True\r\n\r\n\r\n@private\r\ndef mint(_to: address, _value: uint256):\r\n    \"\"\"\r\n    @dev Mint an amount of the token and assigns it to an account. \r\n         This encapsulates the modification of balances such that the\r\n         proper events are emitted.\r\n    @param _to The account that will receive the created tokens.\r\n    @param _value The amount that will be created.\r\n    \"\"\"\r\n    assert _to != ZERO_ADDRESS\r\n    self.total_supply += _value\r\n    self.balanceOf[_to] += _value\r\n    log.Transfer(ZERO_ADDRESS, _to, _value)\r\n\r\n\r\n@private\r\ndef _burn(_to: address, _value: uint256):\r\n    \"\"\"\r\n    @dev Internal function that burns an amount of the token of a given\r\n         account.\r\n    @param _to The account whose tokens will be burned.\r\n    @param _value The amount that will be burned.\r\n    \"\"\"\r\n    assert _to != ZERO_ADDRESS\r\n    self.total_supply -= _value\r\n    self.balanceOf[_to] -= _value\r\n    log.Transfer(_to, ZERO_ADDRESS, _value)\r\n\r\n\r\n@public\r\ndef burn(_value: uint256):\r\n    \"\"\"\r\n    @dev Burn an amount of the token of msg.sender.\r\n    @param _value The amount that will be burned.\r\n    \"\"\"\r\n    self._burn(msg.sender, _value)\r\n\r\n\r\n@public\r\ndef burnFrom(_to: address, _value: uint256):\r\n    \"\"\"\r\n    @dev Burn an amount of the token from a given account.\r\n    @param _to The account whose tokens will be burned.\r\n    @param _value The amount that will be burned.\r\n    \"\"\"\r\n    self.allowances[_to][msg.sender] -= _value\r\n    self._burn(_to, _value)\r\n\r\n\r\n# Utility\r\n@public\r\ndef isMature() -> bool:\r\n    \"\"\"\r\n    @dev Checks maturity conditions\r\n    \"\"\"\r\n    self.expired = self.wax.timeToExpiry(self.maturity)\r\n    return self.expired\r\n\r\n\r\n# Core\r\n@public\r\n@payable\r\ndef write(deposit: uint256) -> bool:\r\n    \"\"\"\r\n    @dev   Writer mints tokens: \r\n                   Underwritten Amount \r\n           cMOAT = ___________________\r\n                   Underlying Parameter\r\n    @param deposit Deposit amount of underlying assets, 18 decimal places\r\n    \"\"\"\r\n    lock_key: uint256 = 0 # Temp variable lock key number\r\n    if(self.user_to_key[msg.sender] > 0): # If user has a key, use their key\r\n        lock_key = self.user_to_key[msg.sender]\r\n        self.lockBook.locks[lock_key].underlying_amount += deposit\r\n    else: # Else, increment key length, and set a new Account\r\n        lock_key = self.lockBook.lock_length + 1 # Temporary lock key is length + 1\r\n        self.lockBook.lock_length += 1 # Increment the lock key length\r\n        self.user_to_key[msg.sender] = lock_key # Set user address to lock key\r\n        self.lockBook.locks[lock_key] = Account({user: msg.sender, underlying_amount: deposit}) # Create new account at [key]\r\n    if(self.lockBook.locks[lock_key].underlying_amount > self.lockBook.highest_lock): # If underlying amount is greater, set new highest_key\r\n        self.lockBook.highest_lock = self.lockBook.locks[lock_key].underlying_amount\r\n        self.highest_key = lock_key\r\n    token_amount: uint256 = deposit * self.decimals / self.underlying  # Example: Underlying Parameter = 2, so if underwriten amount is  12, 12 / 2 = 6 cMOAT tokens minted\r\n    self.underlyingAsset.transferFrom(msg.sender, self, deposit) # User deposits underwritten amount into contract\r\n    self.mint(msg.sender, token_amount)\r\n    log.Write(msg.sender, token_amount, lock_key)\r\n    return True\r\n\r\n\r\n@public\r\n@payable\r\ndef close(amount: uint256) -> bool:\r\n    \"\"\"\r\n    @dev          Writer can burn cMOAT tokens to redeem their underlying deposits\r\n    @param amount Amount of cMOAT tokens to burn, 18 decimals  \r\n    \"\"\"\r\n    key: uint256 = self.user_to_key[msg.sender]\r\n    underlying_redeem: uint256 = self.underlying * amount / self.decimals\r\n    assert self.lockBook.locks[key].underlying_amount >= underlying_redeem # Check user redeeming has underwritten\r\n    assert self.balanceOf[msg.sender] >= amount # Check user has cMOAT tokens to burn\r\n    self.lockBook.locks[key].underlying_amount -= underlying_redeem \r\n    self.underlyingAsset.transfer(msg.sender, underlying_redeem) # Underlying asset redeemed to user\r\n    self._burn(msg.sender, amount) # Burn the cMOAT tokens that were redeemed for underwritten assets\r\n    log.Close(self.lockBook.locks[key].user, amount, key)\r\n    return True\r\n\r\n\r\n@public\r\n@payable\r\ndef exercise(amount: uint256) -> bool:\r\n    \"\"\"\r\n    @dev   Exercising party exchanges strike asset for underlying asset\r\n    @param Amount of cMOAT tokens being exercised, 18 decimals\r\n    \"\"\"\r\n    assert self.balanceOf[msg.sender] >= amount\r\n    strike_payment: uint256 = self.strike * amount / self.decimals\r\n    underlying_payment: uint256 = self.underlying * amount / self.decimals\r\n    self.strikeAsset.transferFrom(msg.sender, self, strike_payment) # Deposit strike asset (10 per option)\r\n    self.underlyingAsset.transfer(msg.sender, underlying_payment) # Withdraw underlying asset (2 per option) from contract\r\n    assigned_user: address = ZERO_ADDRESS\r\n    lock_key: uint256 = 0\r\n    \r\n    \r\n    for x in range(1, MAX_KEY_LENGTH + 1): # Loops over underwriters and depletes underlying_payment outlays\r\n        lock_key = convert(x, uint256)\r\n        if(self.lockBook.highest_lock > underlying_payment): # If the highest underwritten amount > payment, assign that user\r\n            assigned_user = self.lockBook.locks[self.highest_key].user\r\n            lock_key = self.highest_key\r\n            break\r\n        if(self.lockBook.locks[lock_key].underlying_amount > underlying_payment): # If the looped user has underwritten > payment, assign that user\r\n            assigned_user = self.lockBook.locks[lock_key].user\r\n            break\r\n\r\n    \r\n    if(assigned_user == ZERO_ADDRESS): # If no assigned user, need to assign multiple users\r\n        for i in range(1, 3):\r\n            lock_key = convert(i, uint256)\r\n            user: address = self.lockBook.locks[lock_key].user # Get user address of lock_key\r\n            underlying_amount: uint256 = self.lockBook.locks[lock_key].underlying_amount # Get underlying amount of user\r\n            options_exercised: uint256 = underlying_amount * self.decimals / self.underlying  # Get max amount of options that can be exercised\r\n            if(underlying_amount > underlying_payment): # If the looped user has underwritten > underlying left, assign that user\r\n                assigned_user = self.lockBook.locks[lock_key].user\r\n                break\r\n            # We need to exercise options using multiple underwritten balances\r\n            if(user == ZERO_ADDRESS): # If we pass over all users but there are still options oustanding to be exercised, set previous user as user\r\n                user = self.lockBook.locks[lock_key - 1].user\r\n                break\r\n            self.strikeAsset.transfer(user, self.strike / self.decimals * options_exercised ) # Transfer proportional strike payment to entire balance of assigned user\r\n            underlying_payment -= underlying_amount # Update underlying payment leftover   \r\n            log.Exercise(msg.sender, options_exercised, lock_key)\r\n            self._burn(msg.sender, options_exercised) # Burn amount of tokens proportional to entire underlying balance of user\r\n            self.lockBook.locks[lock_key].underlying_amount -= underlying_amount # Update user's underlying amount\r\n        # We have a user who can pay entire leftover exercised amount\r\n        self.strikeAsset.transfer(assigned_user, self.strike / self.underlying * underlying_payment)\r\n        options_exercised: uint256 = underlying_payment / self.underlying * self.decimals\r\n        log.Exercise(msg.sender, options_exercised, lock_key)\r\n        self._burn(msg.sender, options_exercised)\r\n        self.lockBook.locks[lock_key].underlying_amount -= underlying_payment # Assigned user exercises the rest of the underlying payment\r\n        return True\r\n    \r\n    \r\n    # We have a user who can pay entire exercised amount\r\n    self.strikeAsset.transfer(assigned_user, strike_payment)\r\n    self.lockBook.locks[lock_key].underlying_amount -= underlying_payment # Assigned user pays the exercised underlying amount\r\n    log.Exercise(msg.sender, amount, lock_key)\r\n    self._burn(msg.sender, amount)\r\n    return True\r\n\r\n\r\n@public\r\ndef expire() -> bool:\r\n    \"\"\"\r\n    @notice Any user can call this public function to expire this specific cMOAT token\r\n    @dev    Sets total supply to 0, does not burn any tokens\r\n    \"\"\"\r\n    self.expired = True # FIX: temporary test store\r\n    assert self.expired # cMOAT's UNIX timestamp < block.timestamp\r\n    key: uint256 = 1 # Temporary key value \r\n    for x in range(1, MAX_KEY_LENGTH): # For each key, redeem the tokens to their underwriters, burn the cMOAT tokens\r\n        if(self.lockBook.locks[convert(x, uint256)].user == ZERO_ADDRESS): # If we reach end of users in the lock book, end the loop\r\n            break\r\n        key = convert(x, uint256)\r\n        underlying_amt: uint256 = self.lockBook.locks[key].underlying_amount\r\n        user: address = self.lockBook.locks[key].user\r\n        if(underlying_amt > 0):\r\n            self.underlyingAsset.transfer(user, underlying_amt) # underlying asset sent to writer\r\n        self.lockBook.locks[key].underlying_amount = 0\r\n        log.Close(user, underlying_amt / self.underlying * self.decimals, key)\r\n    self.total_supply = 0\r\n    return True",
  "sourcePath": "C:/Users/alexa/OneDrive/Documents/Master/Blockchain/Projects/Emerald_Project/contracts/Genesis.vy",
  "compiler": {
    "name": "vyper",
    "version": "0.1.0b14+commit.49b201c"
  },
  "networks": {
    "5777": {
      "events": {
        "0x33d8dc4a860afa0606947f2b214f16e21e7eac41e3eb6642e859d9626d002ef6": {
          "name": "Write",
          "inputs": [
            {
              "type": "address",
              "name": "_from",
              "indexed": true
            },
            {
              "type": "uint256",
              "name": "amount",
              "indexed": false
            },
            {
              "type": "uint256",
              "name": "key",
              "indexed": false
            }
          ],
          "anonymous": false,
          "type": "event",
          "signature": "0x33d8dc4a860afa0606947f2b214f16e21e7eac41e3eb6642e859d9626d002ef6"
        },
        "0x7fb8af33a94ca7bd709d59757a015eb48270f350724a5409fd77b579d0b7247d": {
          "name": "Exercise",
          "inputs": [
            {
              "type": "address",
              "name": "_from",
              "indexed": true
            },
            {
              "type": "uint256",
              "name": "amount",
              "indexed": false
            },
            {
              "type": "uint256",
              "name": "key",
              "indexed": false
            }
          ],
          "anonymous": false,
          "type": "event",
          "signature": "0x7fb8af33a94ca7bd709d59757a015eb48270f350724a5409fd77b579d0b7247d"
        },
        "0x9d801553d397b8274b513890b6fc73f1a5edcf9ab99ee408d64b6e36889433e0": {
          "name": "Close",
          "inputs": [
            {
              "type": "address",
              "name": "_from",
              "indexed": true
            },
            {
              "type": "uint256",
              "name": "amount",
              "indexed": false
            },
            {
              "type": "uint256",
              "name": "key",
              "indexed": false
            }
          ],
          "anonymous": false,
          "type": "event",
          "signature": "0x9d801553d397b8274b513890b6fc73f1a5edcf9ab99ee408d64b6e36889433e0"
        },
        "0x2eb828fdc16ef5c267a7b18c3f8edf180aaff1a8921c4fe994fef55ddc8abe60": {
          "name": "Mature",
          "inputs": [
            {
              "type": "address",
              "name": "contract_addr",
              "indexed": true
            }
          ],
          "anonymous": false,
          "type": "event",
          "signature": "0x2eb828fdc16ef5c267a7b18c3f8edf180aaff1a8921c4fe994fef55ddc8abe60"
        },
        "0xf817bef87c74de34ab725f43b121c1dff5324aa363f7b9ac176b9aee5115230e": {
          "name": "Payment",
          "inputs": [
            {
              "type": "uint256",
              "name": "amount",
              "indexed": false,
              "unit": "wei"
            },
            {
              "type": "address",
              "name": "source",
              "indexed": true
            }
          ],
          "anonymous": false,
          "type": "event",
          "signature": "0xf817bef87c74de34ab725f43b121c1dff5324aa363f7b9ac176b9aee5115230e"
        },
        "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef": {
          "name": "Transfer",
          "inputs": [
            {
              "type": "address",
              "name": "_from",
              "indexed": true
            },
            {
              "type": "address",
              "name": "_to",
              "indexed": true
            },
            {
              "type": "uint256",
              "name": "_value",
              "indexed": false
            }
          ],
          "anonymous": false,
          "type": "event",
          "signature": "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"
        },
        "0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925": {
          "name": "Approval",
          "inputs": [
            {
              "type": "address",
              "name": "_owner",
              "indexed": true
            },
            {
              "type": "address",
              "name": "_spender",
              "indexed": true
            },
            {
              "type": "uint256",
              "name": "_value",
              "indexed": false
            }
          ],
          "anonymous": false,
          "type": "event",
          "signature": "0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925"
        }
      },
      "links": {},
      "address": "0xaBAaFbC853001f7EbC173A64DFe903335D8A90b0",
      "transactionHash": "0x8cc1ca96ee5f6ad63373e6dbe0450a4e8a0eb231ef97a52dec45b7408447519e"
    }
  },
  "schemaVersion": "3.0.19",
  "updatedAt": "2019-11-26T18:31:24.227Z",
  "networkType": "ethereum"
}